Phyloseq Code

# Install Phyloseq
```{r}
if (!require("BiocManager", quietly = TRUE))
    install.packages("BiocManager")

BiocManager::install("phyloseq")
```

# Load required packages
```{r}
library(phyloseq)
library(dplyr)
library(BiMiCo)
```

# Import metadata
```{r}
metadata<-read.csv("metadata.csv", header=TRUE, row.names = 1)
```

# Create phyloseq object
```{r}
# make sure the seqtab.nochim and taxa objects are loaded
physeq <- phyloseq(otu_table(seqtab.nochim, taxa_are_rows=FALSE), sample_data(metadata), tax_table(taxa))
physeq
```

# Transform sample counts
```{r}
# convert from raw to relative abundance (percentage)
physeq <- transform_sample_counts(physeq, function(abund) 1*(abund>0))
physeq
```

# Remove the sequence itself and replace with ASV
```{r}
dna <- Biostrings::DNAStringSet(taxa_names(physeq))
names(dna) <- taxa_names(physeq)
physeq <- merge_phyloseq(physeq, dna)
taxa_names(physeq) <- paste0("ASV", seq(ntaxa(physeq)))
physeq
```

# Remove mitochondria and chloroplast matches. Remove all non bacterial sequences
```{r}
physeq <- physeq %>% subset_taxa( Family!= "Mitochondria" | is.na(Family) & Order!="Chloroplast" | is.na(Order) )
physeq
```

# Install BiMiCo
```{r}
install.packages("remotes")
remotes::install_github("peterolah001/BiMiCo")
```

# Remove all non bacterial sequences
```{r}
physeq<-rm_nonbac(physeq)
physeq
```

# Save physeq objects to load later
```{r}
save(physeq, file="RData/physeq.RData")
```